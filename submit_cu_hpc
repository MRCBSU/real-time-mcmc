#!/bin/bash
#SBATCH -J trial_hpc_batch
#SBATCH -A MRC-BSU-SL2-CPU
#SBATCH --ntasks=1
#SBATCH --cpus-per-task=14
#SBATCH --time=36:00:00
#! What types of email messages do you wish to receive?
#SBATCH --mail-type=FAIL
#SBATCH --mail-type=TIME_LIMIT
#SBATCH --mail-type=END
#! Uncomment this to prevent the job from being requeued (e.g. if
#! interrupted by node failure or system downtime):
#SBATCH --no-requeue
#SBATCH --verbose

#SBATCH --array=1-8
#SBATCH -p skylake
#SBATCH --qos=covid0


#SBATCH --output=model_runs_20201108prevjobs_%a.out
#SBATCH --error=model_runs_20201108prevjobs_%a.err

workdir="$SLURM_SUBMIT_DIR/model_runs/20201111/"

if [ $SLURM_ARRAY_TASK_ID -lt 5 ]; then
    workdir="${workdir}No"
    if [ $SLURM_ARRAY_TASK_ID -lt 3 ]; then
        workdir="${workdir}Adj"
    else
        workdir="${workdir}No"
    fi
elif [ $SLURM_ARRAY_TASK_ID -lt 7 ]
then
    workdir="${workdir}Adj"
fi
workdir="${workdir}Prev_relax_shortsero_ifr_"
if (( $SLURM_ARRAY_TASK_ID % 2 == 0 ))
then
    workdir="${workdir}28"
else
    workdir="${workdir}60"
fi
workdir="${workdir}cutoff"
if (( $SLURM_ARRAY_TASK_ID % 4 > 0 )) && (( $SLURM_ARRAY_TASK_ID % 4 < 3 ))
then
    workdir="${workdir}1"
else
    workdir="${workdir}6"
fi
workdir="${workdir}day_matrices_20201106_"
if (( $SLURM_ARRAY_TASK_ID % 4 > 0 )) && (( $SLURM_ARRAY_TASK_ID % 4 < 3 ))
then
    workdir="${workdir}adjusted_mean"
else
    workdir="${workdir}deaths"
fi

module load gcc/9 intel/compilers/2020.2

echo $workdir

cd $workdir

if [ -f "posterior_report10" ]; then
    echo "existing output found"
else
    ../../../rtm_hpc
fi
