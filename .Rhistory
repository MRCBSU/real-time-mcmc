dim(census.pops)
dim(sapply(C, diag))
dim(census.pops);dim(nc.pops)
nc.prop
length(popn)
popn
dim(nc.prop)
popn.mat <- matrix(popn, 7, 4)
dim(popn.mat)
popn.mat <- t(matrix(popn, 7, 4))
dim(popn.mat)
popn.mat
nc.prop
popn.mat
C.star.star
popn.expanded.mat
popn.expanded.mat
length(popn.expanded)
popn.expanded
sum(popn.expanded);sum(popn)
dim(m.polymod.expanded)
x <- m.polymod.expanded - t(m.polymod.expanded)
sum(x);var(x);range(x)
q()
n
getwd()
setwd("../../../RTM.code/polymod_matrices/polymod_metaregion/")q
setwd("../../../RTM.code/polymod_matrices/polymod_metaregion/")
source("write_commuting_matrix.R")
dim(Xi.nh.expanded)
dim(Xi.h.expanded)
solve(Xi.h.expanded)
det(Xi.h.expanded)
eigen(Xi.h.expanded)
Xi.h.expanded
Xi.h
length(C.star.star)
m.polymod.expanded
debug(contact.matrix)
n
A
n
R
n
R
n
dim(out.mat)
N.day(1, 1, N, C, R, A)
debug(N.day)
n
istrata(1:R, a, R = R, A = A)
C[[a]][1:R, 1:R]
N
r
C[[a]][1:R, r]
istrata(1:R, a, R = R, A = A)
N[istrata(1:R, a, R = R, A = A)]
Q
q()
n
setwd("/Volumes/Pandemic_flu/RTM.code/polymod_matrices/polymod_metaregion/")
source("write_commuting_matrix.R")
Xi.nh.expanded[44, 37]
q()
n
system("grep -n \"Region_alloc\" *.cc *.h")
system("grep -n \"read_data_inputs\" *.cc *.h")
system("grep -n \"data_matrices_fscanf\" *.cc *.h")
setwd("~/Desktop/")
setwd("/Volumes/Pandemic_flu/Real_Time_Modelling/MCMC/code_repository_v_5")
system("grep -n \"fetch_filenames\" *.cc *.h")
system("make -f GMakefile")
system("grep -n \"set_breakpoints\" *.cc *.h")
system("grep -n \"alloc_and_set\" *.cc *.h")
system("grep -n \"gsl_vector_int_set_seq\" *.cc *.h")
system("grep -n \"setDim\" *.cc *.h")
setwd("~/Desktop/")
setwd("/Volumes/Pandemic_flu/Real_Time_Modelling/MCMC/code_repository_v_5")
source("grep -n \"read_string_from_instruct\" *.cc *.h")
system("grep -n \"read_string_from_instruct\" *.cc *.h")
system("grep -n \"read_dbl_from_delim_string\" *.cc *.h")
system("grep -n \"typename\" *.cc *.h")
system("more test.cc")
setwd("~/Desktop/")
setwd("/Volumes/Pandemic_flu/Real_Time_Modelling/MCMC/code_repository_v_5")
system("grep -n \"read_string_from_instruct\" *.cc *.h")
q()
n
rand.colors(1)
rand.colors(1)
rand.colors(1)
rand.colors(1)
setwd("/project/pandemic_flu/RTM.code/polymod_matrices/polymod_metaregion")
source("write_commuting_matrix.R")
source("write_commuting_matrix.R")
nc.pops
C
popn.expanded.mat
parse(text = popn.expanded.mat)
parse(text = t(popn.expanded.mat))
sum(popn.expanded.mat)
q()
n
seropos <- read.table("/project/pandemic_flu/Data/Seroprevalence/Sero11_05_10/Sero245days_young/Serology_positive_meta4reg.txt", sep = "\t", row.names = 1, header = F)
dim(seropos)
serosamp <- read.table("/project/pandemic_flu/Data/Seroprevalence/Sero11_05_10/Sero245days_young/Serology_sample_meta4reg.txt", sep = "\t", row.names = 1, header = F)
popn <- c(119967, 410926, 840309, 924809.834282399, 64663.1657176011, 2530268.56267077, 217285.437329227, 1465535.67177029, 100909.328229712, 750115.724272603, 132140.275727397,
		 		    68285, 259069, 651598, 698560.409955819, 31848.5900441811, 1369148.85023452, 74775.1497654831, 1290051.34812271, 53671.6518772864, 861778.118861271, 23058.8811387288, 
				    227677, 864277, 2217602, 2604717.18115422, 72065.8188457836, 4943157.13992563, 158755.860074368, 4715295.57392258, 108173.426077415, 3048736.23237211, 45158.7676278887,
				    224805, 863397, 2251281, 2276217.80834998, 139113.191650017, 4643584.1925706, 523216.807429402, 4553290.60152081, 374378.398479193, 3149228.9936084, 149128.0063916)
length(popn)
GP.breaks <- c(0, 2, 3, 5, 7, 9, 11, 13, 14, 16, 18, 20, 22, 24, 25, 27, 29, 31, 33, 35, 36, 38, 40, 42, 44)
sapply(1:24, function(x) rep(x, GP.breaks[x + 1] - GP.breaks[x]))
unlist(sapply(1:24, function(x) rep(x, GP.breaks[x + 1] - GP.breaks[x])))
idx <- unlist(sapply(1:24, function(x) rep(x, GP.breaks[x + 1] - GP.breaks[x])))
length(idx)
(GP.popn <- as.vector(by(popn, idx, sum)))
sero.breaks <- c(0, 1, 2, 3, 5, 7, 9, 11, 12, 13, 14, 16, 18, 20, 22, 23, 24, 25, 27, 29, 31, 33, 34, 35, 36, 38, 40, 42, 44)
idx <- unlist(sapply(1:28, function(x) rep(x, sero.breaks[x + 1] - sero.breaks[x])))
(sero.popn <- as.vector(by(popn, idx, sum)))
popn
(sero.wt <- as.vector(by(popn, idx, x / sum(x))))
(sero.wt <- as.vector(by(popn, idx, function(x) x / sum(x))))
(sero.wt <- unlist(by(popn, idx, function(x) x / sum(x))))
sero.wt[x <- sample.int(44, 1)]
x
x.pos <- seropos[x <- sample.int(245, 1), ]; x.samp <- serosamp[x, ]
x
x.samp
rownames(seropos[x, ])
seropos[120, ];serosamp[120, ]
x.samp
test.positivity <- c(0.88552278118857286,
 0.52502680940686042,
 0.25157878880073259,
 0.30412244627689977,
 0.93699674885028128,
 0.13350814914909892,
 0.55743017440090548,
 0.18558603789252592,
 0.62908608746995365,
 0.2899149415798703,
 0.50973699170362363,
 0.88475036068137591,
 0.49745369686944862,
 0.23819261606923203,
 0.26287604530684916,
 0.97314184570232254,
 0.13624203693615089,
 0.75804468491709476,
 0.16636910533292615,
 0.69510706008075396,
 0.26308906913562147,
 0.79333482226107144,
 0.8172117581265228,
 0.38199093025150199,
 0.14484012938375879,
 0.21782773542336964,
 0.94755551485418299,
 0.11510669906795878,
 0.69386040340496191,
 0.15411443974263972,
 0.65456642458451753,
 0.25247937076014215,
 0.75306598009876702,
 0.86817332695748062,
 0.45764265983827901,
 0.17431958660496139,
 0.25680050219581529,
 0.88919021290891465,
 0.12914432934272435,
 0.42894667178160806,
 0.16214178940174528,
 0.41230945022640519,
 0.25827584523624159,
 0.56986715452943293
)
length(test.positivity)
ls()
sero.wt
length(sero.wt)
test.positivity <- test.positivity * sero.wt
test.positivity
idx
length(idx)
weighted.positivity <- as.vector(by(test.positivity, idx, sum))
weighted.positivity;length(weighted.positivity)
sample.int(28, 1)
system("grep -n \"fn_log_lik_negbindata\" *.cc *.h")
gp.counts <- read.table("/project/pandemic_flu/Data/QSurveillance/Data28_03_10/Reported_GP_Consultations_meta4reg_expanded_28_03_10.txt", sep = "\t", row.names = 1, header = F)
gp.denoms <- read.table("/project/pandemic_flu/Data/QSurveillance/Data28_03_10/Reported_GP_Coverage_meta4reg_expanded_28_03_10.txt", sep = "\t", row.names = 1, header = F)
dim(gp.counts);dim(gp.denoms)
gp.counts <- gp.counts[1:245, ]
gp.denoms <- gp.denoms[1:245, ]
dim(gp.counts);dim(gp.denoms)
mu.gp.full <- c(84.724435180498602,
503.2605677806875,
489.94364552973457,
448.37753268061471,
41.316324551375274,
521.98314654044827,
230.77989951342792,
274.5551937702769,
104.81732406196147,
148.07524869621997,
104.47896542737833,
13.96773133132116,
96.334477977491659,
90.674376626833194,
124.62183340762076,
9.4564646290480496,
113.36836984407147,
64.558525173617596,
65.448897673978323,
47.2768981841173,
37.645353629208174,
17.593917130732105,
192.89021454048302,
953.27895537544271,
737.79852940096589,
681.59160979669684,
45.037478196185468,
651.1408749863092,
195.90317877467498,
343.64450011039037,
127.22384947278965,
185.47947878593448,
50.618648727898808,
163.14512802504518,
1036.0295809444817,
945.64963076531922,
900.14554101537942,
130.94004312539465,
840.94326937828794,
520.32772216947023,
468.3004412282437,
316.96133838410594,
266.94293380348995,
150.49318026474558)
length(mu.gp.full)
idx <- unlist(sapply(1:24, function(x) rep(x, GP.breaks[x + 1] - GP.breaks[x])))
mu.gp.obs <- as.vector(by(mu.gp.full, idx, sum))
length(mu.gp.obs)
mu.gp.obs
mu.gp.obs * denom[120, ]
mu.gp.obs * gp.denom[120, ]
mu.gp.obs * gp.denoms[120, ]
ls()
length(GP.popn)
mu.gp.obs * gp.denoms[120, ] / GP.popn
q()
n
popn <- c(119967, 410926, 840309, 924809.834282399, 64663.1657176011, 2530268.56267077, 217285.437329227, 1465535.67177029, 100909.328229712, 750115.724272603, 132140.275727397,
		 		    68285, 259069, 651598, 698560.409955819, 31848.5900441811, 1369148.85023452, 74775.1497654831, 1290051.34812271, 53671.6518772864, 861778.118861271, 23058.8811387288, 
				    227677, 864277, 2217602, 2604717.18115422, 72065.8188457836, 4943157.13992563, 158755.860074368, 4715295.57392258, 108173.426077415, 3048736.23237211, 45158.7676278887,
				    224805, 863397, 2251281, 2276217.80834998, 139113.191650017, 4643584.1925706, 523216.807429402, 4553290.60152081, 374378.398479193, 3149228.9936084, 149128.0063916)
length(popn)
sum(popn)
gp.counts <- read.table("/project/pandemic_flu/Data/QSurveillance/Data28_03_10/Reported_GP_Consultations_meta4reg_expanded_28_03_10.txt", sep = "\t", header = F, row.names = 1)
dim(gp.counts)
gp.counts <- gp.counts[1:245, ]
gp.cover <- read.table("/project/pandemic_flu/Data/QSurveillance/Data28_03_10/Reported_GP_Coverage_meta4reg_expanded_28_03_10.txt", sep = "\t", header = F, row.names = 1)
dim(gp.cover)
gp.cover <- gp.cover[1:245, ]
popn.gp.breaks <- c(0, 2, 3, 5, 7, 9, 11, 13, 14, 16, 18, 20, 22, 24, 25, 27, 29, 31, 33, 35, 36, 38, 40, 42, 44)
(popn.gp.levels <- sapply(1:ncol(gp.cover), function(x) sum(x > popn.gp.breaks)))
(popn.gp.levels <- sapply(1:length(popn), function(x) sum(x > popn.gp.breaks)))
(popn.gp <- as.vector(by(popn, popn.gp.levels, sum)))
sum(popn.gp)
gp.cover[1, ]
gp.cover <- t(t(gp.cover) / popn.gp)
range(gp.cover)
gp.cover[1:5, ]
sample.int(245, 1)
t <- 165
h1n1 <- c(2.491218798356075,
18.731824615198924,
43.777524624398993,
17.834539065244336,
1.5751591996976562,
19.474992079813138,
12.19215653596634,
10.163557247085723,
4.9868771104841301,
6.5649564596288501,
5.9924849654884245,
0.61244373046939193,
4.7820715546621804,
10.528188488825784,
4.3942506003353126,
0.34992542376567315,
4.5086205562564956,
3.0883677667614311,
2.3923770816436343,
2.0667125004923248,
1.5441952558626322,
0.87374513823437017,
7.3132504930540314,
45.395985026606695,
94.256985517091195,
32.41422923566607,
1.583984774575343,
34.407524129530273,
9.027830151391024,
16.472115286150732,
5.3619582552245841,
10.592495793659225,
2.4716130551861282,
7.959102993967111,
62.360915619153644,
148.72804112629549,
51.56578669132891,
6.0685182043698171,
54.717574321675698,
31.410265879970883,
27.498456616753952,
17.45602371766752,
18.146613197223751,
9.3387096231238029)
length(h1n1)
bg <- c(6.84739, 0.05, -0.05, -0.80178, -1.19384, -1.05751, -0.256948, 0.949222, 0.523633, 0.523633, 0.157471, 0.0970798, 0.0167096, 0.00966079, 7.21818, 0.816711, -0.0533136, -1.03174, -0.725063, -0.152899, -0.108354, 0.0835624, 0.370422, 0.541121, 0.352812, 0.766426, 0.766426, -0.193082, 0.0914051, 0.0888155, -0.244942)
bg.X <- scan("bg_design.txt", );length(bg.X)
12648 / length(bg)
bg.X <- t(matrix(bg.X, 44, 408));dim(bg.X)
bg <- c(6.84739, 0.05, -0.05, -0.80178, -1.19384, -1.05751, -0.256948, 0.949222, 0.523633, 0.523633, 0.157471, 0.0970798, 0.0167096, 0.00966079, 7.21818, 0.816711, -0.0533136, -1.03174, -0.725063, -0.152899, -0.108354, 0.0835624, 0.370422, 0.541121, 0.352812, 0.766426, 0.766426, -0.193082, 0.0914051, 0.0888155, -0.244942)
bg.X <- scan("bg_design.txt", );length(bg.X)
bg.X <- t(matrix(bg.X, length(bg), 408));dim(bg.X)
bg.X[1, ]
B.rate <- exp(bg.X %*% bg)
length(B.rate)
bg.X
12 * 24
11 * 24
bg.rows <- 265:288
B.rate <- B.rate[bg.rows]
bg.X[bg.rows]
bg.X[bg.rows, ]
ls()
popn.gp.levels
length(popn.gp.levels)
length(B.rate)
B.rate <- B.rate[popn.gp.levels]
length(B.rate)
B.rate
length(popn)
B.count <- B.rate * popn / (100000 * 365)
system("grep -n \"365\" *.cc *.h")
B.count <- B.rate * popn / (100000 * 365.25)
B.count
length(h1n1)
h1n1 + B.count
(viropos <- h1n1 / (h1n1 + B.count))
gp <- 2.6822803242556659 * (h1n1 + B.count)
gp
gp.agg <- as.vector(by(gp, popn.gp.levels, sum))
length(gp.agg)
gp.agg
gp / gp.agg[popn.gp.levels]
gp.wts <- gp / gp.agg[popn.gp.levels]
(gp.pos <- as.vector(by(gp.wts, popn.gp.levels, sum)))
gp.wtd.pos <- gp.wts * viropos
(gp.pos <- as.vector(by(gp.wtd.pos, popn.gp.levels, sum)))
popn.gp.levels
popn.viro.breaks <- c(0, 1, 2, 3, 5, 7, 9, 11, 12, 13, 14, 16, 18, 20, 22, 23, 24, 25, 27, 29, 31, 33, 34, 35, 36, 38, 40, 42, 44)
(popn.viro.levels <- sapply(1:length(popn), function(x) sum(x > popn.viro.breaks)))
gp.viro.agg <- as.vector(by(gp, popn.viro.levels, sum))
length(gp.viro.agg)
gp.viro.agg
gp.wts <- gp / gp.viro.agg[popn.viro.levels]
length(gp.wts);length(viropos)
gp.wtd.pos <- gp.wts * viropos
(gp.pos <- as.vector(by(gp.wtd.pos, popn.viro.levels, sum)))
sample.int(50, 1)
hosp <- c(2.6333216380339337,
1.8575000446238217,
1.5001461532128793,
1.1832262034876644,
1.2831518741641357,
0.99017198500782144,
1.2367525635719676,
0.5896394643109768,
0.65749440830271344,
0.27538686088982661,
0.36065710593160161,
58.782143173238012,
37.546656752029634,
27.94964890348427,
15.262356287343966,
11.094637396522657,
19.600422463433802,
13.705895342488038,
10.505723092606083,
7.5590272407819139,
3.9507199826135304,
2.8997492350144967,
1.3312199638016278,
0.88113409989274816,
0.69654527733271443,
0.5116471868629997,
0.71101708756467286,
0.46396471111843762,
0.75200652365822096,
0.26999282170374117,
0.42043580274233872,
0.12040445664960731,
0.1556444816338261,
16.865057879815485,
11.69548790657708,
9.3880433885066346,
7.3198926594371212,
7.9322293588895043,
6.2084394691062652,
7.9974450513323676,
3.6666115598885192,
4.6798486820615359,
1.6804396428877224,
2.1180661091763149)
length(hosp)
ls()
hosp.breaks <- c(0, 1, 2, 3, 5, 7, 9, 11, 12, 13, 14, 16, 18, 20, 22, 23, 24, 25, 27, 29, 31, 33, 34, 35, 36, 38, 40, 42, 44)
(hosp.levels <- sapply(1:length(popn), function(x) sum(x > hosp.breaks)))
(hosp.agg <- as.vector(by(hosp, hosp.levels, sum)))
system("grep -n \"Region_memcpy\" *.cc *.h")
q()
n
system("grep -n \"gsl_compute_max_evalue_evector\" *.cc *.h")
system("grep -n \"mixing_matrix_rescale\" *.cc *.h")
system("grep -n \"mixing_matrix_scale_and_normalisation\" *.cc *.h")
system("grep -n \"normalization\" *.cc *.h")
system("grep -n \"normalized\" *.cc *.h")
getwd()
setwd("../code_repository_v_4/")
system("diff RTM_RegRTM_Beta3.0DEBUG.cc RTM_RegRTM_Beta3.0.cc")
getwd()
setwd("../../../RTM.code/Dev.Dir.Sun/4reg/245days/")
system("diff May02_13_stepwise2a_bgunder5s_NS_nextgenI0/RTM_Likelihoods_hack.cc Nov09_13_metaregion1_eta_scaled_empiricalSeed_hack_bg2a/RTM_Likelihoods_hack.cc")
system("more +353 Nov09_13_metaregion1_eta_scaled_empiricalSeed_hack_bg2a/RTM_Likelihoods_hack.cc")
q()
n
system("grep -n \"HERE!\" *.cc *.h\")
system("grep -n \"HERE\!\" *.cc *.h\")
system("grep -n \"HERE" *.cc *.h\")
system("grep -n \"HERE\" *.cc *.h\")
system("grep -n \"HERE\" *.cc *.h")
system("grep -n \"HERE!\" *.cc *.h")
rand.colors(1)
system("grep -n \"gp_param_fn\" *.cc *.h")
system("grep -n \"R_generalised_linear_regression_GP_PATCH\" *.cc *.h")
system("grep -n \"regional_matrix_parameter_GP_PATCH\" *.cc *.h")
rand.colors(1)
getwd()
setwd("../../../RTM.code/Dev.Dir.Sun/4reg/245days/")
system("direc")
system("diff May02_13_stepwise2a_bgunder5s_NS_nextgenI0/RTM_LikelihoodsDEBUG_hack.cc Nov09_13_metaregion1_eta_scaled_empiricalSeed_hack_bg2a/RTM_LikelihoodsDEBUG_hack.cc")
system("grep -n \"gsl_vector_sum_elements\" *.cc *.h")
q()
n
system("grep -n \"gsl_vector_sum_elements\" *.cc *.h")
setwd("../../../RTM.code/Dev.Dir.Sun/4reg/245days/")
system("diff May02_13_stepwise2a_bgunder5s_NS_nextgenI0/RTM_Likelihoods_hack.cc Nov09_13_metaregion1_eta_scaled_empiricalSeed_hack_bg2a/RTM_Likelihoods_hack.cc")
system("diff May02_13_stepwise2a_bgunder5s_NS_nextgenI0/RTM_WithinRegion.cc Nov09_13_metaregion1_eta_scaled_empiricalSeed_hack_bg2a/RTM_WithinRegion.cc")
system("diff May02_13_stepwise2a_bgunder5s_NS_nextgenI0/RTM_MixingMatrices.cc Nov09_13_metaregion1_eta_scaled_empiricalSeed_hack_bg2a/RTM_MixingMatrices.cc")
system("grep -n \"gsl_compute_max_evalue_evector\" *.cc *.h")
q()
n
system("grep -n \"l_gp_negbin_overdispersion\" *.cc *.h")
system("grep -n \"gsl_matrix_realloc\" *.cc *.h")
system("grep -n \"regional_matrix_parameter\" *.cc *.h")
system("make -f GMakefile_temp")
q()
n
getwd()
system("make -f GMakefile_temp")
rand.colors(1)
system("make -f GMakefile_temp")
system("make -f GMakefile_temp")
system("grep -n \"model_statistics_alloc\" *.cc *.h")
system("make -f GMakefile_temp")
system("make -f GMakefile_temp")
system("make -f GMakefile_temp")
system("make -f GMakefile")
system("make -f GMakefile")
system("make -f gsl_matrix_realloc")
system("grep -n \"gsl_matrix_realloc\" *.cc *.h")
system("make -f GMakefile")
system("grep -n \"l_gp_negbin_overdispersion\" *.cc *.h")
q()
n
system("grep -n \"Region_alloc\" *.cc *.h")
system("make -f GMakefile_temp")
system("make -f GMakefile_temp")
system("grep -n \"Region_alloc\" *.cc *.h")
82 * 24
244 * 7
244 * 24
system("direc")
setwd("..")
system("direc")
q()
n
